<!DOCTYPE html>
<html>
<head>
    <title>Timing / Power Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 40px; background: #f8f9fa; }
        .container { background: white; padding: 30px; border-radius: 8px; max-width: 800px; margin: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .links-row { display: flex; gap: 15px; margin-bottom: 10px; }
        .links-row button { padding: 10px 20px; background: #2c7be5; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .links-row button:hover { background: #1a5db5; }
        input, select { padding: 10px; border-radius: 4px; border: 1px solid #ddd; width: 100%; box-sizing: border-box; }
        button[type=submit] { background: #2c7be5; color: white; border: none; padding: 12px 30px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        button[type=submit]:hover { background: #1a5db5; }
        .result-box { background: #e7f3ff; border: 1px solid #b6d4fe; padding: 20px; border-radius: 8px; margin-top: 20px; }
    </style>
</head>
<body>
<div class="container">
    <h2>Timing / Power Dashboard</h2>

    <label><b>Dashboard Type:</b></label>
    <div class="links-row">
        <button type="button" onclick="setMode('timing')" id="timingBtn">‚è± Timing</button>
        <button type="button" onclick="setMode('power')" id="powerBtn" style="opacity:0.6;">üîå Power</button>
    </div>

    <form method="post" onsubmit="showLoader()">
        <input type="hidden" name="mode" id="modeInput" value="timing">

        <label><b>Search & Navigate Designs:</b></label>
        <input type="text" id="designSearch" onkeyup="filterDesigns()" placeholder="üîç Search folders...">

        <div class="links-row">
            <a href="#" onclick="selectAll(true); return false;">[+] Select All Visible</a>
            <a href="#" onclick="selectAll(false); return false;">[-] Deselect All</a>
        </div>

        <select name="designs" id="designSelect" multiple size="15" required>
            <!-- JS will populate -->
        </select>

        <br><br>
        <label><b>Die Name:</b></label>
        <input name="die" value="ESF" required style="width: 120px;">

        <br><br>
        <button type="submit">Run Dashboard</button>
    </form>

    {% if done %}
        <div class="result-box">
            <h3>‚úÖ Generation Complete</h3>
            {% if comparison %}
                <a href="/files/comparison_dashboard.html" style="font-weight:bold;">üìä Open Comparison Dashboard</a><hr>
            {% endif %}
            {% for design in generated %}
                <a href="/files/{{ design }}.html">üìÇ Open Dashboard: {{ design }}</a><br>
            {% endfor %}
        </div>
    {% endif %}
</div>

<script>
const designsTiming = {{ designs_timing|tojson }};
const designsPower  = {{ designs_power|tojson }};

function setMode(mode) {
    document.getElementById("modeInput").value = mode;
    document.getElementById("timingBtn").style.opacity = (mode === "timing") ? "1" : "0.6";
    document.getElementById("powerBtn").style.opacity  = (mode === "power") ? "1" : "0.6";
    updateDesignList(mode);
}

function updateDesignList(mode) {
    const select = document.getElementById("designSelect");
    select.innerHTML = "";
    const designs = (mode === "timing") ? designsTiming : designsPower;
    designs.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = "üìÇ " + d;
        select.appendChild(opt);
    });
}

window.onload = function() {
    const mode = document.getElementById("modeInput").value || "timing";
    setMode(mode);
};

function filterDesigns() {
    const filter = document.getElementById("designSearch").value.toLowerCase();
    const options = document.getElementById("designSelect").options;
    for (let i = 0; i < options.length; i++) {
        options[i].style.display = options[i].text.toLowerCase().includes(filter) ? "" : "none";
    }
}

function selectAll(bool) {
    const options = document.getElementById("designSelect").options;
    for (let i = 0; i < options.length; i++) {
        if (options[i].style.display !== "none") options[i].selected = bool;
    }
}

function showLoader() {
    // Optionally, add loader overlay
}
</script>
</body>
</html>
